version: "3.3" # optional since v1.27.0
services:
  node:
    image: totar/tezos-node:ithacanet
    volumes:
      - tezosnode:/tezos-ithacanet
    # environment:
    #   - SNAPSHOT=https://snapshots-tezos.giganode.io/snapshots/testnet_20220506-000455_BLZuwXo6MZQWGSt38R2JsUziLAga4U7cXWaNYYGGDE5PBiYSXM6.rolling
  client:
    image: totar/tezos-client:ithacanet
    restart: on-failure
    volumes:
      - tezosclient:/root/.tezos-client
    environment:
      - PRIVATE_KEY="unencrypted:edsk3dV7TQgWP5ckriGL1hhnjUNUVUTd2446TwWYR83jCXb3zCfAWL"
      - WAIT_HOSTS=node:8732
      - WAIT_HOSTS_TIMEOUT=300
      - WAIT_SLEEP_INTERVAL=10
      - WAIT_HOST_CONNECT_TIMEOUT=30
    command: sh -c "/wait && tezos-client --endpoint http://node:8732 import secret key baker unencrypted:edsk3dV7TQgWP5ckriGL1hhnjUNUVUTd2446TwWYR83jCXb3zCfAWL && tezos-client --endpoint http://node:8732 register key baker as delegate"
  baker:
    image: totar/tezos-baker:ithacanet
    restart: on-failure
    volumes:
      - tezosnode:/tezos-node-ithacanet
      - tezosclient:/root/.tezos-client
    environment:
      - NODE_ENDPOINT=http://node:8732
      - WAIT_HOSTS=node:8732
      - WAIT_HOSTS_TIMEOUT=300
      - WAIT_SLEEP_INTERVAL=10
      - WAIT_HOST_CONNECT_TIMEOUT=30

volumes:
  tezosnode: {}
  tezosclient: {}
